<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dendro-5.01: ReadMe</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dendro-5.01
   &#160;<span id="projectnumber">Dendro-5.01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ReadMe </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>For questions: <a href="https://gitter.im/Dendro-5-01/community?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge"></a></p>
<div class="image">
<img src="https://github.com/paralab/Dendro-5.01/blob/master/docs/fig/dendro.png" alt="Dendro" width="400"/>
</div>
<h2>What is Dendro ?</h2>
<p>"Dendro" in Greek language means tree. The Dendro library is a large scale (262K cores on ORNL's Titan) distributed memory adaptive octree framework. The main goal of Dendro is to perform large scale multiphysics simulations efficeiently in mordern supercomputers. Dendro consists of efficient parallel data structures and algorithms to perform variational ( finite element) methods and finite difference mthods on 2:1 balanced arbitary adaptive octrees which enables the users to perform simulations raning from black holes (binary black hole mergers) to blood flow in human body, where applications ranging from relativity, astrophysics to biomedical engineering.</p>
<hr/>
<h2>Get Dendro</h2>
<p>You can clone the repository using , <code>git clone <a href="https://github.com/paralab/Dendro-5.01.git">https://github.com/paralab/Dendro-5.01.git</a></code></p>
<h2>How to build Dendro-5.0 ?</h2>
<p>You need CMake to build dendro. Create a build directory using 'mkdir build'. Then go into the build directory by 'cd build' then execute 'ccmake ..' to generate the make files. You can build Dendro-5.0 with several options.</p>
<ul>
<li><code>ALLTOALLV_FIX</code> : OFF,Need to turn off</li>
<li><code>DIM_2</code>: OFF, This can be turned on if you need to run Dendro-5.0 in 2D case. default: OFF (Which means it assumes 3D domain)</li>
<li><code>HILBERT_ORDERING</code>:ON, This specify which <a class="el" href="namespaceSFC.html">SFC</a> to use to partition the data. HILBERT_ORDERING: ON means it uses Hilbert curve, otherwise it uses Morton curve for partitioning.</li>
<li><code>PROFILE_TREE_SORT</code>: OFF</li>
<li><code>NUM_NPES_THRESHOLD</code>: square root of P (number of processors)</li>
<li><code>SPLITTER_SELECTION_FIX</code>: ON. This will perform the data exchange in the octree partitioning in stages. This is mandatory when you run dendro in very large scale.</li>
</ul>
<h2>Simple simulation: Nonlinear Sigma Model (NLSigma)</h2>
<p>NlSigma folder consists of simple, non lineat wave equation with adaptive mesh refinement (AMR). You can copy the parameter file from <code>NLSigma/pars</code> folder and simply run <code>mpirun -np 8 ./NlSigma/nlsmSolver nlsm.par.json</code>, on your lattop to large supercomputer with higher resolution.</p>
<p>|</p><div class="image">
<img src="https://github.com/paralab/Dendro-5.01/blob/master/docs/fig/nlsmB7.png" alt="nlsm" width="200"/>
</div>
<p> |</p><div class="image">
<img src="https://github.com/paralab/Dendro-5.01/blob/master/docs/fig/nlsmB11.png" alt="nlsm" width="200"/>
</div>
<p> | </p><div class="image">
<img src="https://github.com/paralab/Dendro-5.01/blob/master/docs/fig/nlsmB16.png" alt="nlsm" width="200"/>
</div>
<p> | </p><div class="image">
<img src="https://github.com/paralab/Dendro-5.01/blob/master/docs/fig/nlsmB44.png" alt="nlsm" width="200"/>
</div>
<p> |</p>
<p>You can write the equations in symbolic python which generate the C compute kernel. Look at <code>nlsm.py</code></p>
<div class="fragment"><div class="line">import dendro</div><div class="line">from sympy import *</div><div class="line">###############################################################</div><div class="line">#  initialize</div><div class="line">###############################################################</div><div class="line">r = symbols(&#39;r&#39;)</div><div class="line"># declare functions</div><div class="line">chi = dendro.scalar(&quot;chi&quot;,&quot;[pp]&quot;)</div><div class="line">phi = dendro.scalar(&quot;phi&quot;,&quot;[pp]&quot;)</div><div class="line">d = dendro.set_first_derivative(&#39;grad&#39;)    # first argument is direction</div><div class="line">d2s = dendro.set_second_derivative(&#39;grad2&#39;)  # first 2 arguments are directions</div><div class="line">d2 = dendro.d2</div><div class="line"></div><div class="line">###############################################################</div><div class="line">#  evolution equations</div><div class="line">###############################################################</div><div class="line"></div><div class="line">phi_rhs = sum( d2(i,i,chi)  for i in dendro.e_i ) - sin(2*chi)/r**2</div><div class="line">chi_rhs = phi</div><div class="line"></div><div class="line">###############################################################</div><div class="line">#  evolution equations</div><div class="line">###############################################################</div><div class="line">outs = [phi_rhs, chi_rhs]</div><div class="line">vnames = [&#39;phi_rhs&#39;, &#39;chi_rhs&#39;]</div><div class="line">dendro.generate(outs, vnames, &#39;[pp]&#39;)</div></div><!-- fragment --><p>Which generate the code,</p>
<div class="fragment"><div class="line">// Dendro: {{{ </div><div class="line">// Dendro: original ops:  10</div><div class="line">// Dendro: printing temp variables</div><div class="line"></div><div class="line">// Dendro: printing variables</div><div class="line">//--</div><div class="line">phi_rhs[pp] = grad2_0_0_chi[pp] + grad2_1_1_chi[pp] + grad2_2_2_chi[pp] - sin(2*chi[pp])/pow(r, 2);</div><div class="line">//--</div><div class="line">chi_rhs[pp] = phi[pp];</div><div class="line">// Dendro: reduced ops:  10</div><div class="line">// Dendro: }}}</div></div><!-- fragment --><h3>Parameters for NLSigma</h3>
<ul>
<li>Grid parameters<ul>
<li><code>NLSM_GRID_MIN_X</code>, <code>NLSM_GRID_MIN_Y</code>, <code>NLSM_GRID_MIN_Z</code>: The minimum coordinate values for the computational domain in the <em>x</em>-, <em>y</em>-, and <em>z-* directions.</em></li>
<li><em><code>NLSM_GRID_MAX_X</code>, <code>NLSM_GRID_MAX_Y</code>, <code>NLSM_GRID_MAX_Z</code>: The maximum coordinate values for the computational domain in the *x</em>-, <em>y</em>-, and *z-* directions.</li>
</ul>
</li>
<li>Evolution parameters<ul>
<li><code>NLSM_CFL_FACTOR</code>: The Courant factor used for time integration. <em>dt</em> = <code>NLSM_CFL_FACTOR *</code> <em>dx</em></li>
<li><code>KO_DISS_SIGMA</code>: Coefficient for Kreiss-Oliger dissipation that is added to the solution.</li>
<li><code>NLSM_RK45_TIME_BEGIN</code>: Initial time label for the evolution, usually this is set to 0.</li>
<li><code>NLSM_RK45_TIME_END</code>: The final time for the evolution. The code exits when this time is reached.</li>
<li><code>NLSM_RK45_TIME_STEP_SIZE</code>: Initial time step for the Runge-Kutta 4-5 adaptive time integrator.</li>
<li><code>NLSM_RK45_DESIRED_TOL</code>: Tolerance for the RK4-5 adaptive time integrator.</li>
</ul>
</li>
<li>Output parameters<ul>
<li><code>NLSM_IO_OUTPUT_FREQ</code>: Frequency for output. Output is written as 3D VTK files.</li>
<li><code>NLSM_VTU_FILE_PREFIX</code>: Prefix for naming the output files. Each processor outputs all variables to a single file labeled by the timestep.</li>
<li><code>NLSM_NUM_EVOL_VARS_VTU_OUTPUT</code>: The number of evolution variables to be output.</li>
<li><code>NLSM_VTU_OUTPUT_EVOL_INDICES</code>: A list of variable indices to specify which variables will be written to output. The first <code>NLSM_NUM_EVOL_VARS_VTU_OUTPUT</code> in this list are written to the output file.</li>
</ul>
</li>
<li>General refinement parameters<ul>
<li><code>NLSM_MAXDEPTH</code>: The maximum refinement depth for the octree. The minimum possible grid resolution is proportional to 1/2^k, where k is the maximum depth.</li>
<li><code>NLSM_REMESH_TEST_FREQ</code>: Frequency for updating an adaptive grid.</li>
<li><code>NLSM_LOAD_IMB_TOL</code>: Dendro load imbalance tolerance for flexible partitioning.</li>
<li><code>NLSM_DENDRO_GRAIN_SZ</code>: Grain size N/p , Where N number of total octants, p number of active cores. This is essentially the number of octants per core, and essentially functions as a measure of the computational load per core. (Dendro does not automatically use all cores that are available in a multiprocessor run, but gives each core a minimum amount of work before adding new cores.)</li>
</ul>
</li>
<li>Wavelet refinement parameters<ul>
<li><code>NLSM_WAVELET_TOL</code>: The wavelet error tolerance for the solution. Refinement is added when the estimated error in the solution, measured by the wavelet coefficient, is larger than this tolerance.</li>
<li><code>NLSM_NUM_REFINE_VARS</code>: The number of variables used to evaluate refinement on the grid.</li>
<li><code>NLSM_REFINE_VARIABLE_INDICES</code>: A list of variable indicies to specify which variables are used to determine the grid refinement. Wavelet coefficients will be calculated for the first <code>NLSM_NUM_REFINE_VARS</code> in this list.</li>
<li><code>NLSM_DENDRO_AMR_FAC</code>: A factor to determine the threshold for coarsening the grid. The grid is coarsened when the wavelet coefficients are less than <code>NLSM_DENDRO_AMR_FAC * NLSM_WAVELET_TOL</code>.</li>
</ul>
</li>
<li>Block refinement parameters<ul>
<li><code>NLSM_ENABLE_BLOCK_ADAPTIVITY</code>: Block adaptivity provides simple fixed-mesh refinement. The grid is refined to the maximum depth (or minimum resolution) inside a fixed region set by <code>NLSM_BLK_MIN_X</code>, <code>NLSM_BLK_MAX_X</code>, and related variables. Set this parameter to "1" to enable block adaptivity, or "0" otherwise (default). Block adaptivity is used primarily for testing and debugging. For example, a uniform grid can be created by specifying maximum refinement region to cover the entire domain.</li>
<li><code>NLSM_BLK_MIN_X</code>: The minimum <em>x</em>-coordinate for the block that is refined to the maximum depth. Same for <em>y</em>- and <em>z</em>-coordinates.</li>
<li><code>NLSM_BLK_MAX_X</code>: The maximum <em>x</em>-coordinate for the block that is refined to the maximum depth. Same for <em>y</em>- and <em>z</em>-coordinates.</li>
</ul>
</li>
<li>Checkpoint parameters<ul>
<li><code>NLSM_RESTORE_SOLVER</code>: Set this parameter to "1" to read from checkpoint files, otherwise set it to "0" (default). When checkpointing is used, the code automatically selects the latest checkpoint files for restoring the solver.</li>
<li><code>NLSM_CHECKPT_FREQ</code>: The checkpoint frequency.</li>
<li><code>NLSM_CHKPT_FILE_PREFIX</code>: A string prefix for naming the checkpoint files.</li>
</ul>
</li>
</ul>
<hr/>
<h2>Scalability on octree generation and partitioning.</h2>
<p>We have performed octree generation and partitioning up to 262144 cores in ORNL's titan super computer. We have managed to partition 1.3x10^12 octants among 262144 processors with in 4 seconds.</p>
<div class="image">
<img src="https://github.com/paralab/Dendro-5.01/blob/master/docs/fig/titan_ws.png" alt="weak scaling on octrees" width="800"/>
</div>
 <div class="image">
<img src="https://github.com/paralab/Dendro-5.01/blob/master/docs/fig/titan_ss.png" alt="strong scaling on octrees" width="800"/>
</div>
<h2>Publications</h2>
<ul>
<li>Milinda Fernando, David Neilsen, Hyun Lim, Eric Hirschmann, Hari Sundar, ”Massively Parallel Simulations of Binary Black Hole Intermediate-Mass-Ratio Inspirals” SIAM Journal on Scientific Computing 2019. '<a href="https://doi.org/10.1137/18M1196972'">https://doi.org/10.1137/18M1196972'</a></li>
<li>Milinda Fernando, David Neilsen, Hari Sundar, ”A scalable framework for Adaptive Computational General Relativity on Heterogeneous Clusters”, (ACM International Conference on Supercomputing, ICS’19)</li>
<li>Milinda Fernando, Dmitry Duplyakin, and Hari Sundar. 2017. ”Machine and Application Aware Partitioning for Adaptive Mesh Refinement Applications”. In Proceedings of the 26th International Symposium on High-Performance Parallel and Distributed Computing (HPDC ’17). ACM, New York, NY, USA, 231-242. DOI: '<a href="https://doi.org/10.1145/3078597.3078610'">https://doi.org/10.1145/3078597.3078610'</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
